---
date: 2025-03-24 11:05:58
title: 常用hooks
permalink: /pages/436437
author:
  name: 华总
  link: https://xiaoying.org.cn
categories:
  - 使用指南
  - hooks
---

## useBusuanzi

给网站、博客文章添加阅读次数统计

```vue
<script setup lang="ts">
import { useBusuanzi } from "liyao-vue-common";
const { site_pv, site_uv, page_pv, page_uv } = useBusuanzi();
</script>

<template>
 <div>
    <p>站点访问量: {{ site_pv }}</p>
    <p>站点访客数: {{ site_uv }}</p>
    <p>当前页面访问量: {{ page_pv }}</p>
    <p>当前页面访客数: {{ page_uv }}</p>
 </div>
</template>
```

## useDayDiff

计算给定时间的相差天数

```typescript
import { useDayDiff } from "liyao-vue-common";
const { diffDays } = useDayDiff("2024-01-01");
console.log(diffDays.value); 

```

## useTimeDiff

计算给定时间的相差时间(年/月/日/时/分)

```typescript
import { useTimeDiff } from "liyao-vue-common";
const { timeDiff   } = useTimeDiff("2024-01-01");
console.log(timeDiff  .value); 
```

## useFileDownloader

下载Base64及Blob文件

```typescript
import { useFileDownloader } from "liyao-vue-common";

const { base64ToFile, blobToFile } = useFileDownloader();

// 下载 Base64 文件
base64ToFile("yourBase64String", "example.txt", "text/plain");

// 下载 Blob 文件
const blob = new Blob(["Hello, world!"], { type: "text/plain" });
blobToFile(blob, "hello.txt", "text/plain");

```

## useCopyToClipboard.ts

将指定的文本复制到剪贴板，触发复制后可以执行某些操作

```vue
<template>
  <div>
    <input v-model="clipboardText" placeholder="输入要复制的文本" />
    <button @click="copyText">复制</button>
    <p v-if="isSuccess">复制成功！</p>
    <p v-else-if="copied">复制失败。</p>
  </div>
</template>

<script setup lang="ts">
import { useCopyToClipboard } from 'liyao-vue-common';

const { clipboardRef, isSuccessRef, copiedRef } = useCopyToClipboard();

const clipboardText = clipboardRef; //响应式存储要复制的文本内容
const isSuccess = isSuccessRef;    // 标记最后一次复制操作是否成功
const copied = copiedRef;         // 标记是否已触发复制操作（无论成功与否）

const copyText = () => {
  if(copied){
    ElMessage.warning("开通会员")
  }
  // 修改 clipboardRef 的值触发复制操作
  clipboardRef.value = clipboardText.value;
};
</script>
```

## useWatermark

设置防篡改水印

### 参数

```typescript
type waterMarkOptions = {
    // 自定义水印的文字大小
    fontSize?: number;
    // 自定义水印的文字颜色
    fontColor?: string;
    // 自定义水印的文字字体
    fontFamily?: string;
    // 自定义水印的文字对齐方式
    textAlign?: CanvasTextAlign;
    // 自定义水印的文字基线
    textBaseline?: CanvasTextBaseline;
    // 自定义水印的文字倾斜角度
    rotate?: number;
};
```

### 使用

- 默认添加到`document.body`，如果添加到其他元素要保证添加水印的元素（此例中为 `#app`）的 `position` 属性设为 `relative` 或者 `absolute`，这样水印才能正确定位。

- 可按需调整 `waterMarkOptions` 对象里的配置选项，例如 `fontSize`、`fontColor`、`rotate` 等。

```vue
<template>
  <div id="app">
    <h1>水印示例</h1>
    <button @click="addWatermark">添加水印</button>
    <button @click="removeWatermark">移除水印</button>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import { useWatermark } from 'liyao-vue-common'; 

const appRef = ref<HTMLElement | null>(null);

const { setWatermark, clear } = useWatermark(appRef, {
  // waterMarkOptions...
  fontSize: 16,
  fontColor: 'rgba(0, 0, 0, 0.2)',
  rotate: 30
});

const addWatermark = () => {
  setWatermark('自定义水印文本');
};

const removeWatermark = () => {
  clear();
};
</script>

<style scoped>
#app {
  position: relative;
  padding: 20px;
}
</style>
```

## useScript

### 异步加载第三方脚本

```vue
<template>
  <div>
    <p v-if="isLoading">脚本正在加载中...</p>
    <p v-if="success">脚本加载成功！</p>
    <p v-if="error && isTimeout">脚本加载超时，已重试 {{ getRetryCount() }} 次。</p>
    <p v-if="error && !isTimeout">脚本加载出错，请检查脚本链接或网络状况。</p>
    <button @click="runScriptDependentFunction" :disabled="!success">运行依赖脚本的功能</button>
  </div>
</template>

<script setup lang="ts">
import { useScript } from 'liyao-vue-common';

const { isLoading, error, success, isTimeout } = useScript({
  src: 'https://example.com/your-script.js',
});

const runScriptDependentFunction = () => {
  if (success.value) {
    // 调用脚本中定义的函数
    window.doSomething(); 
  }
};
</script>
```

### 顺序加载多个脚本

顺序加载指的是按顺序依次加载脚本，前一个脚本加载完成后再加载下一个脚本。可以使用 `async/await` 或者 `Promise` 的链式调用来实现。

```typescript
import { useScript } from 'liyao-vue-common';

// 定义多个脚本选项
const scriptOptionsList = [
    { src: 'https://example.com/script1.js', timeout: 5000, maxRetries: 3 },
    { src: 'https://example.com/script2.js', timeout: 5000, maxRetries: 3 },
    { src: 'https://example.com/script3.js', timeout: 5000, maxRetries: 3 }
];

// 使用 async/await 实现顺序加载
async function loadScriptsSequentially() {
    for (const options of scriptOptionsList) {
        const { isLoading, error, success, isTimeout } = useScript(options);
        try {
            await new Promise((resolve, reject) => {
                const checkStatus = () => {
                    if (success.value) {
                        resolve();
                    } else if (error.value) {
                        reject(new Error(isTimeout.value ? '脚本加载超时' : '脚本加载出错'));
                    } else {
                        setTimeout(checkStatus, 100);
                    }
                };
                checkStatus();
            });
            console.log(`${options.src} 加载成功`);
        } catch (err) {
            console.error(`${options.src} 加载失败:`, err);
            break; // 若某个脚本加载失败，停止后续脚本的加载
        }
    }
}

// 调用顺序加载函数
loadScriptsSequentially();
```

### 并行加载多个脚本

并行加载意味着同时加载多个脚本，这些脚本的加载过程相互独立。可以使用 `Promise.all` 来实现。

```typescript
import { useScript } from 'liyao-vue-common';

// 定义多个脚本选项
const scriptOptionsList = [
    { src: 'https://example.com/script1.js', timeout: 5000, maxRetries: 3 },
    { src: 'https://example.com/script2.js', timeout: 5000, maxRetries: 3 },
    { src: 'https://example.com/script3.js', timeout: 5000, maxRetries: 3 }
];

// 并行加载多个脚本
function loadScriptsInParallel() {
    const promises = scriptOptionsList.map(options => {
        const { isLoading, error, success, isTimeout } = useScript(options);
        return new Promise((resolve, reject) => {
            const checkStatus = () => {
                if (success.value) {
                    resolve();
                } else if (error.value) {
                    reject(new Error(isTimeout.value ? '脚本加载超时' : '脚本加载出错'));
                } else {
                    setTimeout(checkStatus, 100);
                }
            };
            checkStatus();
        });
    });

    Promise.all(promises)
      .then(() => {
            console.log('所有脚本加载成功');
        })
      .catch(err => {
            console.error('部分脚本加载失败:', err);
        });
}

// 调用并行加载函数
loadScriptsInParallel();
```

